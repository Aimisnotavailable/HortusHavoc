<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Draw A Garden</title>
    <link rel="stylesheet" href="src/styles.css">
    <link rel="icon" href="./templates/src/assets/favicon.png" sizes="32x32" type="image/png">
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; }
        #game-container { position: relative; width: 100%; height: 100%; }
        canvas { display: block; width: 100%; height: 100%; } 
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div id="plant-tooltip" style="display: none; position: absolute; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; border: 1px solid #4caf50; pointer-events: none; z-index: 100;">
            <div id="tooltip-author" style="font-weight: bold; color: #4caf50;"></div>
            <div style="font-size: 12px;">Hp: <span id="tooltip-hp"></span></div>
            <div style="font-size: 12px;">Vitality: <span id="tooltip-vit"></span></div>
            <div style="font-size: 12px;">Age: <span id="tooltip-age"></span></div>
            <div style="font-size: 12px;">Growth Status: <span id="tooltip-growth-status"></span></div>
        </div>

        <div id="ui-layer">
            
            <div class="hud-bar">
                
                <div class="glass-panel">
                    <span id="ui-time-icon" class="icon">â˜€ï¸</span> 
                    <span id="ui-time-text">12:00</span>
                    <span class="divider">|</span>
                    <span id="ui-weather">Clear</span>
                </div>

                <div class="glass-panel">
                    <div class="stat-item" title="Wind Speed">
                        <span class="icon">ğŸ’¨</span> <span id="ui-wind-speed">0</span>
                        <span id="ui-wind-arrow" style="display:inline-block; transition: transform 0.5s;">â¡</span>
                    </div>
                </div>

                <div class="glass-panel stats row">
                    <div class="stat-item" title="Light Beams">
                        <span class="icon">âœ¨</span><span id="ui-beams">0%</span>
                    </div>
                    <div class="stat-item" title="Snow">
                        <span class="icon">â„ï¸</span> <span id="ui-snow">0%</span>
                    </div>
                    <div class="stat-item" title="Puddles">
                        <span class="icon">ğŸ’§</span> <span id="ui-puddle">0%</span>
                    </div>
                </div>

                <div class="glass-panel life-pill">
                    <div class="stat-item" title="Alive Plants">
                        <span class="icon">ğŸŒ±</span> <span id="ui-plant-count">0</span>
                    </div>
                </div>

                <div class="glass-panel death-pill">
                    <span class="icon" title="Dead Plants">ğŸ’€</span>
                    <span id="ui-death-count">0</span>
                </div>
            </div>

            <div class="bottom-controls">
                <button id="btn-sound" class="glass-btn-circle" title="Toggle Sound">ğŸ”Š</button>
                <button id="btn-about" class="glass-btn-circle" title="About">?</button>
            </div>
        </div>

        <div id="editor-modal" class="glass-modal-container">
            <div class="editor-header">
                <h2>Plant Lab</h2>
            </div>
            <div class="input-group">
                <input type="text" id="username" placeholder="NAME YOUR GARDENER" maxlength="15">
            </div>
            <div class="layer-controls">
                <button id="btn-layer-stem" class="btn-layer active" title="Stem">ğŸ‹</button>
                <button id="btn-layer-leaves" class="btn-layer" title="Leaves">ğŸƒ</button>
                <button id="btn-layer-flower" class="btn-layer" title="Flower">ğŸŒº</button>
            </div>
            <div class="canvas-stack-container">
                <canvas id="canvas-stem" class="layer-canvas active" width="200" height="400"></canvas>
                <canvas id="canvas-leaves" class="layer-canvas inactive" width="200" height="400"></canvas>
                <canvas id="canvas-flower" class="layer-canvas inactive" width="200" height="400"></canvas>
            </div>
            <div class="editor-tools">
                <div class="tool-row">
                    <label>Color</label>
                    <input type="color" id="editor-color" value="#4caf50">
                </div>
                <div class="tool-row">
                    <label>Size</label>
                    <input type="range" id="editor-size" min="2" max="40" value="10">
                </div>
            </div>
            <div class="editor-actions">
                <button id="btn-clear" class="btn-action btn-glass-red">Clear</button>
                <button id="btn-save" class="btn-action btn-glass-green">Grow!</button>
                <button id="btn-cancel" class="btn-action">Cancel</button>
            </div>
        </div>

        <div id="about-modal" class="glass-modal-container">
            <div class="editor-header">
                <h2>The Global Garden</h2>
            </div>
            
            <div style="text-align: left; padding: 0 15px; opacity: 0.9; font-weight: 300; line-height: 1.6;">
                <p>
                    <strong style="color: #4caf50;">CREATE.</strong> 
                    Draw a unique plant to add life to the world. Your creation remains here for others to see.
                </p>
                <p>
                    <strong style="color: #64b5f6;">NURTURE.</strong>
                    The weather is harsh. <strong>Click on any plant</strong>â€”yours or a stranger'sâ€”to shield it from the storm. You are the guardian of this ecosystem.
                </p>
                <p>
                    <strong style="color: #ffb74d;">WITNESS.</strong>
                    Experience a living atmosphere. From gentle breezes to rare auroras, the environment reacts to the community.
                </p>
            </div>

            <div style="text-align: center; margin: 30px 0 20px 0; font-size: 28px; letter-spacing: 15px; opacity: 0.8; filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));">
                ğŸŒ±ğŸ›¡ï¸â›ˆï¸
            </div>

            <p style="font-size: 11px; opacity: 0.4; text-align: center; letter-spacing: 1px; text-transform: uppercase;">
                Current Version: Alpha 1.0 <br>
                Status: Waiting for Guardians
            </p>

            <div class="editor-actions">
                <button id="btn-close-about" class="btn-action">Enter the Garden</button>
            </div>
        </div>

    </div>

    <script type="module" src="src/main.js"></script>

    <script type="module">
        import { AUDIO } from './src/audio.js';

        // --- Sound Toggle ---
        const btnSound = document.getElementById('btn-sound');
        let isMuted = true;

        btnSound.addEventListener('click', () => {
            isMuted = !isMuted;
            btnSound.innerHTML = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';

            // Check what methods your AUDIO object has
            if (AUDIO) {
                if (typeof AUDIO.mute === 'function') {
                    // Method A: Dedicated mute function
                    isMuted ? AUDIO.mute() : AUDIO.unmute();
                } else if (typeof AUDIO.setVolume === 'function') {
                    // Method B: Set volume to 0
                    AUDIO.setVolume(isMuted ? 0 : 0.5);
                } else if (AUDIO.ctx && typeof AUDIO.ctx.suspend === 'function') {
                    // Method C: Raw Audio Context (Suspend/Resume)
                    isMuted ? AUDIO.ctx.suspend() : AUDIO.ctx.resume();
                } else {
                    console.log("Audio object found, but no mute method detected.");
                }
            } else {
                console.error("AUDIO module not found.");
            }
        });

        // --- About Modal ---
        const btnAbout = document.getElementById('btn-about');
        const aboutModal = document.getElementById('about-modal');
        const btnCloseAbout = document.getElementById('btn-close-about');

        btnAbout.addEventListener('click', () => {
            aboutModal.style.display = 'block';
        });

        btnCloseAbout.addEventListener('click', () => {
            aboutModal.style.display = 'none';
        });
        
        window.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                aboutModal.style.display = 'none';
            }
        });
    </script>
</body>
</html>